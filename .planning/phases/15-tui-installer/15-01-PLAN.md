# Phase 15: TUI Installer

**Status:** Planned
**Goal:** Create interactive terminal installer using OpenTUI
**Depends on:** Phase 14 (tiered install flags must exist first)

---

## Background

Replace flag-based installation with beautiful interactive TUI. Same tech stack as OpenCode (dogfooding OpenTUI).

**Why:**
- Users don't need to memorize flags
- Visual selection of components
- Progress feedback during install
- Professional UX (like Railway, Arch installer)

---

## Tech Stack

| Component | Choice |
|-----------|--------|
| Framework | OpenTUI (@opentui/core) |
| Reconciler | React (@opentui/react) |
| Runtime | Bun |
| Build | esbuild via OpenTUI |

**References:**
- https://github.com/anomalyco/opentui (8.1k stars)
- https://github.com/msmps/opentui-examples
- https://github.com/msmps/opentui-skill

---

## Installation Methods

```bash
# One-liner (downloads and runs TUI)
curl -fsSL https://sincronizado.dev/install | bash

# Via npx
npx sincronizado

# Via bunx (faster)
bunx sincronizado

# Direct (if cloned)
cd sincronizado/installer && bun run start
```

---

## Screen Flow

```
┌──────────────────────────────────────────────────────────┐
│  1. WELCOME                                              │
│     - Logo/branding                                      │
│     - Version info                                       │
│     - [Continue] [Exit]                                  │
└──────────────────────────────────────────────────────────┘
                          ↓
┌──────────────────────────────────────────────────────────┐
│  2. MODE SELECT                                          │
│     ○ Minimal - Core only (ET, OpenCode, UFW)           │
│     ● Standard - Recommended (+ Agent-OS, ccmanager)    │
│     ○ Full - Everything (+ all plugins)                 │
│     ○ Custom - Pick individual components               │
└──────────────────────────────────────────────────────────┘
                          ↓
┌──────────────────────────────────────────────────────────┐
│  3. ADDONS (if Custom or to override)                    │
│     [x] Agent-OS (mobile web UI)                        │
│     [x] ccmanager (session management)                  │
│     [ ] Kimaki (Discord bot)                            │
│     [ ] LunaRoute (AI proxy/debug)                      │
│     [ ] Worktree Sessions (git isolation)               │
│     [ ] Session Handoff (context continuation)          │
└──────────────────────────────────────────────────────────┘
                          ↓
┌──────────────────────────────────────────────────────────┐
│  4. VPS PROVIDER                                         │
│     ○ Oracle Cloud (Free tier)                          │
│     ○ Hetzner                                           │
│     ○ DigitalOcean                                      │
│     ○ AWS                                               │
│     ○ Other / Manual                                    │
└──────────────────────────────────────────────────────────┘
                          ↓
┌──────────────────────────────────────────────────────────┐
│  5. CONFIGURATION                                        │
│     VPS Hostname: [ oracle.tail1234.ts.net ]            │
│     SSH User:     [ ubuntu                   ]            │
│     Project Root: [ ~/projects               ]            │
└──────────────────────────────────────────────────────────┘
                          ↓
┌──────────────────────────────────────────────────────────┐
│  6. CONFIRM                                              │
│     Mode: Standard                                       │
│     Addons: Agent-OS, ccmanager                         │
│     Provider: Oracle                                     │
│     Target: oracle.tail1234.ts.net                      │
│                                                          │
│     [Install] [Back] [Cancel]                           │
└──────────────────────────────────────────────────────────┘
                          ↓
┌──────────────────────────────────────────────────────────┐
│  7. INSTALL PROGRESS                                     │
│     ✓ Connecting to VPS...                              │
│     ✓ Installing base dependencies...                   │
│     ● Installing Eternal Terminal...  [████████░░] 80%  │
│     ○ Installing OpenCode...                            │
│     ○ Configuring UFW...                                │
│     ○ Installing Agent-OS...                            │
│                                                          │
│     [Cancel]                                            │
└──────────────────────────────────────────────────────────┘
                          ↓
┌──────────────────────────────────────────────────────────┐
│  8. COMPLETE                                             │
│     ✓ Installation complete!                            │
│                                                          │
│     Next steps:                                          │
│     1. Run: ./launcher/opencode.ps1                     │
│     2. Access mobile UI: http://vps:3000                │
│                                                          │
│     [Open Docs] [Exit]                                  │
└──────────────────────────────────────────────────────────┘
```

---

## Project Structure

```
sincronizado/
├── installer/
│   ├── src/
│   │   ├── index.tsx           # Entry point
│   │   ├── App.tsx             # Router/state management
│   │   ├── screens/
│   │   │   ├── Welcome.tsx
│   │   │   ├── ModeSelect.tsx
│   │   │   ├── Addons.tsx
│   │   │   ├── Provider.tsx
│   │   │   ├── Config.tsx
│   │   │   ├── Confirm.tsx
│   │   │   ├── Install.tsx
│   │   │   └── Complete.tsx
│   │   ├── components/
│   │   │   ├── Header.tsx
│   │   │   ├── RadioGroup.tsx
│   │   │   ├── CheckboxGroup.tsx
│   │   │   ├── TextInput.tsx
│   │   │   ├── ProgressBar.tsx
│   │   │   └── Button.tsx
│   │   ├── hooks/
│   │   │   ├── useInstaller.ts  # Install state machine
│   │   │   └── useSSH.ts        # SSH subprocess wrapper
│   │   └── lib/
│   │       ├── config.ts        # Generate setup-vps.sh flags
│   │       └── ssh.ts           # Execute remote commands
│   ├── package.json
│   ├── tsconfig.json
│   └── bun.lock
├── scripts/
│   ├── setup-vps.sh            # Must support all flags from TUI
│   ├── install.sh              # curl one-liner bootstrap
│   └── ...
└── ...
```

---

## Implementation Tasks

### Phase 15.1: Project Scaffold
**Effort:** 0.5h

- [ ] Create installer/ directory
- [ ] Initialize with `bun create tui`
- [ ] Configure TypeScript, biome
- [ ] Add opentui-skill for AI assistance

### Phase 15.2: Core Components
**Effort:** 1.5h

- [ ] Header component (logo, version)
- [ ] RadioGroup component
- [ ] CheckboxGroup component
- [ ] TextInput component
- [ ] Button component
- [ ] ProgressBar component

### Phase 15.3: Screen Implementation
**Effort:** 2h

- [ ] Welcome screen
- [ ] ModeSelect screen (Minimal/Standard/Full/Custom)
- [ ] Addons screen (checkboxes)
- [ ] Provider screen (radio)
- [ ] Config screen (text inputs)
- [ ] Confirm screen (summary)
- [ ] Install screen (progress)
- [ ] Complete screen (next steps)

### Phase 15.4: State Management
**Effort:** 1h

- [ ] Installer state machine
- [ ] Screen navigation (back/forward)
- [ ] Config accumulation
- [ ] Flag generation for setup-vps.sh

### Phase 15.5: SSH Integration
**Effort:** 1.5h

- [ ] SSH subprocess wrapper
- [ ] Stream stdout/stderr to progress
- [ ] Error handling and retry
- [ ] Cancel/abort support

### Phase 15.6: Distribution
**Effort:** 1h

- [ ] Build standalone binary (bun build --compile)
- [ ] Create install.sh bootstrap
- [ ] Publish to npm as `sincronizado`
- [ ] Test curl one-liner

### Phase 15.7: Testing & Polish
**Effort:** 1h

- [ ] Test all screen transitions
- [ ] Test keyboard navigation
- [ ] Test error states
- [ ] Polish animations/styling

---

## Prerequisites

Phase 14 must add flags to setup-vps.sh:

```bash
# Flags the TUI will call
./setup-vps.sh \
  --mode=standard \
  --with-kimaki \
  --with-lunaroute \
  --provider=oracle \
  --host=oracle.tail1234.ts.net \
  --user=ubuntu
```

---

## Estimated Effort

| Task | Time |
|------|------|
| Phase 15.1: Scaffold | 0.5h |
| Phase 15.2: Components | 1.5h |
| Phase 15.3: Screens | 2h |
| Phase 15.4: State | 1h |
| Phase 15.5: SSH | 1.5h |
| Phase 15.6: Distribution | 1h |
| Phase 15.7: Polish | 1h |
| **Total** | **8.5h** |

---

## Success Criteria

- [ ] `bunx sincronizado` launches TUI
- [ ] All modes install correctly (minimal/standard/full/custom)
- [ ] Progress shows real-time output from VPS
- [ ] Cancel/abort works mid-install
- [ ] curl one-liner works on fresh machine
- [ ] Keyboard navigation is intuitive

---

## Open Questions

1. Should TUI run locally or on VPS?
   - **Local** (recommended): User runs TUI on their machine, SSHs to VPS
   - Remote: User SSHs first, then runs TUI on VPS

2. Binary distribution?
   - npm/bunx (requires Node/Bun)
   - Standalone binary (larger, no deps)
   - Both?

3. Windows support?
   - OpenTUI works on Windows
   - Need to test PowerShell/CMD compatibility
